# Patch: macos-mman-compatibility
# Author: comphy-lab (issue identified by Peter Croxford)
# Date: 2025-11-03
# Description: Fix macOS compilation errors for memory mapping functions
#
# The macOS SDK doesn't expose certain POSIX memory mapping constants and
# function declarations that Basilisk expects. This patch adds the missing
# definitions for MAP_ANON, MAP_ANONYMOUS, POSIX_MADV_DONTNEED, MADV_DONTNEED,
# and explicitly declares the madvise() function.
#
# Platform: macOS only (guarded by #ifdef __APPLE__)
# Files: src/ast/std/sys/mman.h
#
diff -rN -u old-basilisk/src/ast/std/sys/mman.h new-basilisk/src/ast/std/sys/mman.h
--- old-basilisk/src/ast/std/sys/mman.h	2025-11-03 14:33:31
+++ new-basilisk/src/ast/std/sys/mman.h	2025-11-03 14:33:31
@@ -1 +1,19 @@
 @include <sys/mman.h>
+
+// macOS compatibility: Explicitly define missing constants and function declarations
+#ifdef __APPLE__
+# ifndef MAP_ANON
+#  define MAP_ANON 0x1000
+# endif
+# ifndef MAP_ANONYMOUS
+#  define MAP_ANONYMOUS MAP_ANON
+# endif
+# ifndef POSIX_MADV_DONTNEED
+#  define POSIX_MADV_DONTNEED 4
+# endif
+# ifndef MADV_DONTNEED
+#  define MADV_DONTNEED POSIX_MADV_DONTNEED
+# endif
+// Ensure madvise() is declared
+int madvise(void *, size_t, int);
+#endif
